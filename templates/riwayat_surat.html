<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Riwayat Nomor Surat | BAPPERIDA Konawe Utara</title>
  <style>
    body {
      font-family: 'Poppins', Arial, sans-serif;
      background: linear-gradient(180deg, #eaf4ff 0%, #f8fbff 100%);
      margin: 0;
      padding: 0;
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    header {
      background-color: #007bff;
      color: white;
      width: 100%;
      padding: 20px 0;
      text-align: center;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    header h1 {
      font-size: 1.8em;
      margin: 0;
      letter-spacing: 0.5px;
    }

    main {
      width: 95%;
      max-width: 1000px;
      background-color: white;
      margin-top: 30px;
      padding: 25px 35px;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
    }

    form {
      text-align: center;
      margin-bottom: 25px;
    }

    input[type="text"] {
      padding: 12px 15px;
      width: 70%;
      max-width: 400px;
      font-size: 1.1em;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-sizing: border-box;
      transition: all 0.3s;
    }

    input[type="text"]:focus {
      border-color: #007bff;
      outline: none;
      box-shadow: 0 0 5px rgba(0,123,255,0.3);
    }

    button {
      padding: 12px 20px;
      font-size: 1.1em;
      border: none;
      border-radius: 8px;
      background-color: #007bff;
      color: white;
      cursor: pointer;
      transition: 0.3s;
      margin-left: 5px;
    }

    button:hover {
      background-color: #0056b3;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      font-size: 1.05em;
    }

    th {
      background-color: #007bff;
      color: white;
      text-align: center;
      padding: 12px;
      font-weight: 600;
    }

    td {
      padding: 10px 12px;
      border-bottom: 1px solid #eee;
      text-align: center;
    }

    tr:hover {
      background-color: #f0f8ff;
      transition: background-color 0.3s;
    }

    .no-data {
      text-align: center;
      color: #777;
      font-style: italic;
    }

    .back-btn {
      display: inline-block;
      margin-top: 25px;
      background-color: #28a745;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-size: 1.05em;
      transition: 0.3s;
    }

    .back-btn:hover {
      background-color: #1e7e34;
    }

    footer {
      margin-top: auto;
      text-align: center;
      padding: 15px;
      color: #777;
      font-size: 0.9em;
    }

    @media (max-width: 700px) {
      input[type="text"] {
        width: 90%;
        margin-bottom: 10px;
      }

      table {
        font-size: 0.9em;
      }

      th, td {
        padding: 8px;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>üìú Riwayat Nomor Surat - BAPPERIDA Konawe Utara</h1>
  </header>

  <main>
    <form method="GET" action="{{ url_for('riwayat_surat') }}">
      <input type="text" name="keyword" value="{{ keyword }}" placeholder="Cari berdasarkan kode, perihal, atau tahun...">
      <button type="submit">üîç Cari</button>
    </form>
{% if session.get('admin_logged_in') %}
  {% if session.get('role') == 'admin' %}
    <div style="text-align:right; margin-bottom:15px;">
        <a href="{{ url_for('export_excel', keyword=keyword) }}"
            style="background-color:#17a2b8; color:white; text-decoration:none;padding:10px 15px; border-radius:8px; font-weight:bold;">
            üì• Ekspor ke Excel
        </a>
    </div>
    {% endif %}
{% endif %}

<table>
  <thead>
    <tr>
      <th>No</th>
      <th>Kode Klasifikasi</th>
      <th>Nomor Surat</th>
      <th>Perihal</th>
      <th>Tanggal</th>
      <th>File Surat</th>  <!-- kolom baru -->
    </tr>
  </thead>
  <tbody>
    {% if data %}
      {% for item in data %}
      <tr>
        <td>{{ loop.index }}</td>
        <td>{{ item['kode_klasifikasi'] }}</td>
        <td>{{ item['kode_klasifikasi'] }}/{{ item['nomor'] }}{% if item['suffix'] %}.{{ item['suffix'] }}{% endif %}/{{ item['bulan'] }}/{{ item['tahun'] }}</td>
        <td>{{ item['perihal'] }}</td>
        <td>{{ item['tanggal'] }}</td>

        <!-- kolom baru berisi tombol lihat/unduh -->
        <td>
          {% if item['nama_file'] %}
            <a href="{{ url_for('uploaded_file', filename=item['nama_file']) }}" target="_blank"
               style="background-color:#007bff; color:white; padding:6px 10px; border-radius:6px; text-decoration:none;">
               üìÇ Lihat Surat
            </a>
          {% else %}
            <span style="color:#888;">(Tidak ada file)</span>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    {% else %}
      <tr><td colspan="6" class="no-data">Tidak ada data ditemukan</td></tr>
    {% endif %}
  </tbody>
</table>

    <a href="{{ url_for('index') }}" class="back-btn">‚¨Ö Kembali ke Halaman Utama</a>
  </main>

  <footer>
    ¬© {{ datetime.utcnow().year }} BAPPERIDA Konawe Utara | Sistem Penomoran Surat
  </footer>
</body>
</html>
